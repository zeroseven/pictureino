var __defProp=Object.defineProperty,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__publicField=(e,t,i)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,i);class Observer{constructor(e){__publicField(this,"element"),__publicField(this,"resizeObserver",null),__publicField(this,"intersectionObserver",null),__publicField(this,"resizeTimeout",null),this.element=e}onResize(i,s){var e;null!=(e=this.resizeObserver)&&e.disconnect(),this.resizeObserver=new ResizeObserver(e=>{this.resizeTimeout&&window.clearTimeout(this.resizeTimeout);let t=e[0];this.resizeTimeout=window.setTimeout(()=>{var e;s&&Math.abs(s.width-t.contentRect.width)/s.width<=.02&&Math.abs(s.height-t.contentRect.height)/s.height<=.02||(i({width:t.contentRect.width,height:t.contentRect.height},this),null!=(e=this.resizeObserver)&&e.disconnect())},150)}),this.resizeObserver.observe(this.element)}inView(t){var e;null!=(e=this.intersectionObserver)&&e.disconnect(),this.intersectionObserver=new IntersectionObserver(e=>{e[0].isIntersecting&&(t(this),null!=(e=this.intersectionObserver))&&e.disconnect()},{threshold:.1,rootMargin:"0px"}),this.intersectionObserver.observe(this.element)}disconnect(){var e;this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),null!=(e=this.resizeObserver)&&e.disconnect(),null!=(e=this.intersectionObserver)&&e.disconnect()}}class Loader{constructor(){__publicField(this,"cache"),this.cache=new Map}requestImage(t){if(this.cache.has(t)){var e=this.cache.get(t);if(e)return Promise.resolve(e)}return fetch(t).then(async e=>{var t=await e.json();return e.ok?t:t.error?Promise.reject(t.error):Promise.reject({error:{message:e.statusText,code:e.status}})}).then(e=>(this.cache.set(t,e),e))}clearCache(){this.cache.clear()}removeFromCache(e){this.cache.delete(e)}}class Image{constructor(e,t){__publicField(this,"element"),__publicField(this,"config"),__publicField(this,"observer"),__publicField(this,"loader"),__publicField(this,"sources"),__publicField(this,"size"),this.element=e,this.config=t,this.observer=new Observer(this.element),this.loader=new Loader,this.sources={},this.size={width:this.element.offsetWidth,height:this.element.offsetHeight},this.observeElement=this.observeElement.bind(this),this.init()}getRequestUri(){return`/-/img/${parseInt(this.size.width.toString(),10)}x${parseInt(this.size.height.toString(),10)}/${Math.round(window.innerWidth)}${1<window.devicePixelRatio?2:1}x${this.config}/`}updateImage(e){this.element.width=e.processed.width,this.element.height=e.processed.height,this.element.src=e.processed.img,e.processed.img2x&&(this.element.srcset=e.processed.img2x+" 2x")}updateSourceTag(e,t){e=this.sources[e];e&&(e.width=t.processed.width,e.height=t.processed.height,t.processed.img2x?e.srcset=t.processed.img+", "+t.processed.img2x+" 2x":e.srcset=t.processed.img)}getSourceKey(t){var e=Object.keys(this.sources).map(Number);return e.length&&(e=e.filter(e=>e<=t)).length?Math.max(...e):0}updateSource(){this.element.dataset.loaded="false",this.loader.requestImage(this.getRequestUri()).then(e=>{var t=this.getSourceKey(e.view);t?this.updateSourceTag(t,e):this.updateImage(e),this.element.addEventListener("load",()=>{this.observeElement(),this.element.dataset.loaded="true"},{once:!0})}).catch(this.observeElement)}observeElement(){this.observer.onResize(e=>{this.size=e,this.updateSource()},this.size)}init(){["onload","srcset"].forEach(e=>{this.element.removeAttribute(e)});var e=this.element.closest("picture");e&&Array.prototype.slice.call(e.getElementsByTagName("source")).forEach(e=>{var t=e.getAttribute("media");t&&(t=t.match(/\d+/))&&t[0]&&(t=parseInt(t[0],10))&&(this.sources[t]=e)}),this.observer.inView(()=>this.updateSource())}}class Picturerino{static getConfig(e){return e.getAttribute("data-config")}static handle(e){var t=Picturerino.getConfig(e);new Image(e,t)}}window.Picturerino={handle:e=>Picturerino.handle(e)};